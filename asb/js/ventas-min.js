let tbl_Venta,tbl_Mat,init=()=>{$("#Form_Ventas")[0].reset(),$("#Form_Ventas").on("submit",(function(t){save_Venta(t)})),$("#Form_Mat").on("submit",(function(t){save_Mat(t)})),select_Mat(),listar_Ventas()};$(".ir-arriba").click((function(){$("body, html").animate({scrollTop:"0px"},300)})),$(window).scroll((function(){$(this).scrollTop()>0?$(".ir-arriba").slideDown(300):$(".ir-arriba").slideUp(300)})),$("#btnAdd").click((function(){$("#div_Ventas").attr("hidden",!0),$("#div_Form").attr("hidden",!1),$("#btnSave").click(),$("#btnSave").attr("disabled",!1),$("#btnFinalizar").attr("disabled",!1),$("#btnCancelar").attr("disabled",!1),$("#btnPrint").attr("disabled",!1),$("#btnAddMat").attr("disabled",!1)})),$("#btnBack").click((function(){tbl_Venta.ajax.reload(),$("#div_Ventas").attr("hidden",!1),$("#div_Form").attr("hidden",!0),$("#Form_Ventas")[0].reset(),$("#Form_Mat")[0].reset(),$("#Id_Mat").selectpicker("refresh"),$("#tbl_Mat body").html("")}));let listar_Ventas=()=>{tbl_Venta=$("#tbl_Venta").dataTable({aProcessing:!0,aServerSide:!0,dom:"Bfrtip",buttons:["copyHtml5","excelHtml5","csvHtml5","pdf"],ajax:{url:"../Archivos/Ventas/ventas.php?op=listar_Ventas",type:"post",dataType:"json"},bDestroy:!0,iDisplayLength:1e3,order:[[0,"desc"]]}).DataTable()},save_Venta=t=>{t.preventDefault();let a=new FormData($("#Form_Ventas")[0]);$.ajax({type:"post",url:"../Archivos/Ventas/ventas.php?op=save_Venta",data:a,processData:!1,contentType:!1,success:t=>{(t=JSON.parse(t)).Status?$("#Id_Venta").val(t.Id_Venta):swal.fire(t.msg,t.msg2,"error")}})},verVenta=t=>{subir(),$("#div_Ventas").attr("hidden",!0),$("#div_Form").attr("hidden",!1),$.post("../Archivos/Ventas/ventas.php?op=verVenta",{Id_Venta:t},(a=>{$("#Id_Venta").val(t),$("#Cliente").val(a.Cliente),$("#Tel").val(a.Tel),$("#Correo").val(a.Correo),$("#Direccion").val(a.Direccion),$("#Obs").val(a.Obs),$("#Total").val(a.Total),$("#TotLetra").val(a.TotLetra),"A"!=a.Status&&($("#btnSave").attr("disabled",!0),$("#btnFinalizar").attr("disabled",!0),$("#btnCancelar").attr("disabled",!0),$("#btnAddMat").attr("disabled",!0)),"B"==a.Status?$("#btnPrint").attr("disabled",!0):$("#btnPrint").attr("disabled",!1)}),"json"),mat_Venta(t)},mat_Venta=t=>{tbl_Mat=$("#tbl_Mat").dataTable({aProcessing:!0,aServerSide:!0,dom:"Bfrtip",buttons:["copyHtml5","excelHtml5","csvHtml5","pdf"],ajax:{url:"../Archivos/Ventas/ventas.php?op=mat_Venta",type:"post",data:{Id_Venta:t},dataType:"json"},bDestroy:!0,iDisplayLength:1e3,order:[[0,"desc"]]}).DataTable()},select_Mat=()=>{$.post("../Archivos/Ventas/ventas.php?op=select_Mat",(t=>{$("#Id_Mat").html(t),$("#Id_Mat").selectpicker()}),"html")};$("#Id_Mat").change((function(){let t=this.value;$.post("../Archivos/Ventas/ventas.php?op=ver_Mat",{Id_Mat:t},(t=>{$("#Ganancia").val(t.Ganancia),$("#Costo").val(t.Costo),$("#Cost").val(t.Cost),$("#UM").val(t.UM),$("#Cant").attr("max",t.Stock)}),"json")}));let save_Mat=t=>{t.preventDefault();let a=$("#Id_Venta").val(),e=new FormData($("#Form_Mat")[0]);e.append("Id_Venta",a),$.ajax({type:"post",url:"../Archivos/Ventas/ventas.php?op=save_Mat",data:e,processData:!1,contentType:!1,success:t=>{tbl_Mat.ajax.reload(),updateTot(a),t.includes("correctamente")?(swal.fire(t,"","success"),$("#Form_Mat")[0].reset(),$("#Id_Mat").selectpicker("refresh")):swal.fire(t,"","error")}})},delMat=(t,a,e,n)=>{Swal.fire({title:"Se qutará este material!",text:"",icon:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then((r=>{r.isConfirmed&&$.post("../Archivos/Ventas/ventas.php?op=delMat",{Id_Venta:t,Id_Mat:e,Cons:a,Cant:n},(a=>{tbl_Mat.ajax.reload(),updateTot(t),a.includes("correctamente")?swal.fire(a,"","success"):swal.fire(a,"","error")}))}))};$("#btnFinalizar").click((function(){let t=$("#Id_Venta").val();Swal.fire({title:"Se finalizará esta venta!",text:"No se podrán agragar más atículos a la venta!",icon:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",cancelButtonText:"Cancelar",confirmButtonText:"Continuar"}).then((a=>{a.isConfirmed&&$.post("../Archivos/Ventas/ventas.php?op=finalizar",{Id_Venta:t},(a=>{tbl_Mat.ajax.reload(),updateTot(t),a.includes("correctamente")?swal.fire(a,"","success"):swal.fire(a,"","error")}))}))})),$("#btnCancelar").click((function(){let t=$("#Id_Venta").val();Swal.fire({title:"Se Cancelar esta venta!",text:"Se eliminarán los materiales agregados en esta venta!\nEste proceso es irreversible!",icon:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",cancelButtonText:"Cancelar",confirmButtonText:"Continuar"}).then((a=>{a.isConfirmed&&$.post("../Archivos/Ventas/ventas.php?op=cancelar",{Id_Venta:t},(a=>{tbl_Mat.ajax.reload(),updateTot(t),a.includes("correctamente")?swal.fire(a,"","success"):swal.fire(a,"","error")}))}))}));let updateTot=t=>{$.post("../Archivos/Ventas/ventas.php?op=updateTot",{Id_Venta:t},(t=>{$("#Total").val(t.Total),$("#TotLetra").val(t.TotLetra)}),"json")};$("#btnPrint").click((function(){impVenta(Id_Venta.value)}));let impVenta=t=>{window.open("../Archivos/Ventas/pdf_venta.php?Id_Venta="+btoa(t),"blank")},subir=()=>{var t=$(".box").offset().top;$("html,body").animate({scrollTop:t},{duration:"slow"})};init();